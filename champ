#! /usr/bin/env python

## CARRERA CHAMPS
##
##   A script to start a race for LAPS laps on a Carrera Digital 132/124
##   slot car set.
##
##   You must supply the mac address of your Control Unit and the number
##   laps you want to race for (default=6)
##
##   Usage: ./champs CU_MAC_ADDRESS LAPS PLAYERS
##   Example: ./champs ab:12:cd:34:ef:45 10

import curses

from optparse import OptionParser

#from carreralib import ControlUnit

class Player:
    def __init__(self, name):
        self.name = name
        self.laps = 0

class Race:
    def __init__(self, cu, laps, players):
        self.laps = laps
        self.cu = cu
        self.players = list(map(lambda n: Player(n), players))

    def start(self):
        pass

    def run(self):
        pass

op = OptionParser()

op.add_option("-c", "--control-unit", action="store",
              type="string", dest="cu",
              help="The mac address of your Carrera control unit")
op.add_option("-l", "--laps", action="store",
              type="int", dest="laps",
              default=6, help="Number of laps to race for")
op.add_option("-b", "--brakes", action="store_true",
              default=False, dest="brakes",
              help="Enable automatic braking")
op.add_option("-s", "--speed", action="store",
              type="int", dest="speed", default=8,
              help="Top speed (1..10)")
op.add_option("-p", "--player", dest="players",
              type="string", action="append",
              help="The name of a player")

(options, args) = op.parse_args()

#cu = ControlUnit(sys.argv[1])
cu = 1

#stdscr = curses.initscr()
#curses.noecho()
#curses.cbreak()

race = Race(cu, options.laps, options.players or [])
race.start()
race.run()

#curses.echo()
#curses.nocbreak()
#curses.endwin()

#cu.start()

# Start looping.
  # On Timer - add player and increment laps.
  # If player.laps >= laps, end.
